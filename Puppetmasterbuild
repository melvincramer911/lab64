# note, run as root on the puppet master

#echo "adding puppet repo"
cd ~

#echo "get puppet REPO and install it"
#wget https://apt.puppetlabs.com/puppet6-release-bionic.deb
#dpkg -i puppet6-release-bionic.deb

#echo "updating my server with apt update"
#apt update

#echo "backing up /etc/hosts"
#cp -a /etc/hosts /etc/hosts.org.$(date +%s)

#echo "commenting out all the lines of /etc/hosts"
#sed -i 's/^\([^#]\)/#\1/g' /etc/hosts

#echo "setup 127.0.0.1 to hostname "
#echo "127.0.0.1 localhost `hostname` puppet "  >> /etc/hosts
#cat /etc/hosts 

#echo "installing puppet server !!"
#apt-get install puppetserver -y 

echo "backing up  /etc/puppetlabs/puppet/puppet.conf"
cp -a  /etc/puppetlabs/puppet/puppet.conf  /etc/puppetlabs/puppet/puppet.conf.org.$(date +%s)

echo "Commenting out lines in /etc/puppetlabs/puppet/puppet.conf"
sed -i 's/^\([^#]\)/#\1/g' /etc/puppetlabs/puppet/puppet.conf 


## populate the puppet.conf file making sure I put in the HOSTNAME.  NOT needed if it has public ip   
cat <<EOF >>  /etc/puppetlabs/puppet/puppet.conf 
[main]
certname = `hostname`

[master]
certname = `hostname`
vardir = /opt/puppetlabs/server/data/puppetserver
logdir = /var/log/puppetlabs/puppetserver
rundir = /var/run/puppetlabs/puppetserver
pidfile = /var/run/puppetlabs/puppetserver/puppetserver.pid
codedir = /etc/puppetlabs/code
EOF










